# 📔 系統功能手冊 (Features Manual)

## 1. 家族樹視覺化 (Family Visualization)

### 核心佈局邏輯
系統使用 **Dagre** 演算法進行自動化階層佈局，並結合自定義的幾何計算來優化顯示：
- **家庭群組 (Family Group)**：夫妻被視為一個群組，並以各 50% 寬度並排顯示。
- **愛心錨點 (Heart Anchor)**：位於夫妻圖示的幾何中心（透過 `(X1+X2)/2` 計算），作為子女連線的唯一出發點。
- **防止重疊**：設定了 `nodesep: 80` (節點間距) 與 `ranksep: 100` (層級間距) 以確保視覺清晰度。

### 使用者互動
- **拖曳 (Drag)**：長按任意成員或愛心圖示可移動位置。系統會自動鎖定 Y 軸並保持夫妻相對位置，確保樹狀結構不被破壞。
- **縮放 (Zoom)**：使用滑鼠滾輪或觸控手勢進行縮放。
- **迷你地圖 (MiniMap)**：左下角提供全覽圖，可快速跳轉視野。

## 2. 成員管理 (Data Management)

### 基本操作
- **新增成員**：點擊右下角「+」或右上角「新增成員」按鈕。
- **編輯成員**：點擊成員卡片右上角的編輯圖示（Hover 時顯示）。
- **刪除成員**：在編輯模式或選取模式下進行刪除。刪除時會自動移除相關的親屬連結。

### 批次模式 (Batch Mode)
點擊右上角「批次模式」進入：
1. **設定父母**：選取多位成員後，點擊「設定父母」，可一次性將他們連結到同一對父母（適合處理多子女情況）。
2. **批量刪除**：勾選多位成員後一次刪除。

### 支援欄位
除了基本姓名性別外，系統完整支援以下欄位，並可與 CSV 同步：
- **職業 / 頭銜 (Job Title)**
- **備註 (Notes)**
- **過世原因 (Cause of Death)**
- **狀態 (Status)**：如「殁」，系統會自動將成員卡片轉為黑白並加上虛線框。

## 3. 資料同步與匯出 (Sync & Export)

### Google Sheet 雲端同步
無需後端資料庫，直接讀取公開的 Google Sheet CSV：
1. 在 Google Sheet 中點擊 `檔案` > `分享` > `發布到網路`。
2. 選擇 `CSV` 格式並複製連結。
3. 在系統點擊「讀取雲端表單」，貼上連結即可。

### 匯出圖片 (Image Export)
- **CORS 容錯**：若成員照片來自外部網站且被 CORS 阻擋，系統會自動使用預設空白頭像替代，確保圖片能成功產出。
- **高解析度**：預設使用 1.5x 像素比率匯出，以獲得清晰的列印品質。

### CSV 備份
- **匯出**：將目前畫布上的所有資料匯出為 CSV 檔。
- **匯入**：讀取 CSV 檔還原家族樹。
